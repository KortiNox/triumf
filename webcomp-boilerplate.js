(()=>{class e extends HTMLElement{constructor(){super(),this.templates=["template 1","template 2","template 3"],this.selectedTemplateIndex=2,this.innerHTML='\n        <style>\n          /* Общий стиль контейнера редактора */\n          .editor-container {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            border-right: 2px solid #4A90E2; /* более толстая граница с акцентом */\n            background-color: #1e1e2f; /* темный фон */\n            color: #e0e0e0; /* светлый цвет текста */\n          }\n          /* Кнопка вставки */\n          .insert-button {\n            background-color: #6FCF97; /* мягкий зеленый */\n            color: #fff;\n            border: none;\n            padding: 12px 20px;\n            margin: 12px;\n            cursor: pointer;\n            font-weight: 600;\n            border-radius: 8px;\n            transition: background-color 0.3s;\n          }\n          .insert-button:hover {\n            background-color: #55b67f;\n          }\n          /* Область редактора */\n          .editor-area {\n            flex: 1;\n            padding: 15px;\n            background-color: #2c2c3c; /* чуть светлее, чтобы выделить область */\n            border-radius: 8px;\n            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);\n            overflow-y: auto;\n          }\n          /* Панель шаблонов */\n          .templates-panel {\n            width: 280px;\n            padding: 15px;\n            background-color: #3b3b4a; /* немного светлее фона */\n            color: #f0f0f0;\n            display: flex;\n            flex-direction: column;\n          }\n          /* Заголовок шаблонов */\n          .templates-header {\n            font-size: 20px;\n            font-weight: 700;\n            margin-bottom: 12px;\n            border-bottom: 2px solid #4A90E2;\n            padding-bottom: 6px;\n          }\n          /* Список шаблонов */\n          .template-list {\n            background-color: #44465A;\n            margin-bottom: 20px;\n            border-radius: 6px;\n            overflow: hidden;\n          }\n          /* Элемент шаблона */\n          .template-item {\n            padding: 8px 12px;\n            cursor: pointer;\n            transition: background-color 0.2s;\n          }\n          .template-item:hover {\n            background-color: #5C5C6E;\n          }\n          /* Выделенный шаблон */\n          .template-item.selected {\n            background-color: #4A90E2;\n            color: #fff;\n          }\n          /* Панель кнопок добавления/удаления */\n          .template-buttons {\n            display: flex;\n            justify-content: flex-end;\n            margin-bottom: 20px;\n          }\n          /* Стиль кнопок +конфигурация */\n          .template-button {\n            width: 36px;\n            height: 36px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin-left: 8px;\n            cursor: pointer;\n            font-size: 20px;\n            font-weight: 700;\n            border: none;\n            border-radius: 50%;\n            transition: background-color 0.2s, transform 0.2s;\n          }\n          .add-template {\n            background-color: #4CAF50; /* яркий зеленый */\n            color: #fff;\n          }\n          .add-template:hover {\n            background-color: #45a049;\n            transform: scale(1.05);\n          }\n          .remove-template {\n            background-color: #E53935; /* насыщенный красный */\n            color: #fff;\n          }\n          .remove-template:hover {\n            background-color: #c62828;\n            transform: scale(1.05);\n          }\n          /* Раздел редактирования шаблона */\n          .edit-template-section {\n            margin-top: 20px;\n          }\n          .edit-template-label {\n            font-size: 16px;\n            font-weight: 600;\n            margin-bottom: 8px;\n          }\n          /* Ввод для редактирования */\n          .edit-template-input {\n  width: 100%; /* чтобы занимало всю доступную ширину контейнера */\n  max-width: 250px; /* ограничьте максимальную ширину */\n  padding: 8px 12px;\n  border-radius: 6px;\n  border: 1px solid #4A90E2;\n  background-color: #2c2c3c;\n  color: #fff;\n  font-size: 14px;\n  box-sizing: border-box; /* чтобы padding не увеличивал ширину */\n          }\n          /* Стиль компонента шаблона внутри редактора */\n          .template-component {\n            display: inline-block;\n            border: 1px dashed #FFCC00;\n            border-radius: 4px;\n            background-color: #FFD70066; /* прозрачный желтый */\n            padding: 3px 8px;\n            margin: 2px;\n            cursor: pointer;\n            min-width: 130px;\n            font-weight: 600;\n          }\n          /* Стиль ошибок */\n          .template-error {\n            display: inline-block;\n            color: #e53935;\n            font-weight: bold;\n            padding: 3px 6px;\n            margin: 2px;\n            border: 1px solid #e53935;\n            border-radius: 4px;\n            background-color: #ffebee;\n            font-size: 13px;\n          }\n          /* TinyMCE стили */\n          .tox .template-component {\n            display: inline-block;\n            border: 1px dashed #FFCC00;\n            border-radius: 4px;\n            background-color: #ffd70066;\n            padding: 3px 8px;\n            margin: 2px;\n            cursor: pointer;\n            min-width: 130px;\n            font-weight: 600;\n          }\n          /* Контекстное меню компонента внутри редактора */\n          .template-dropdown {\n            position: absolute;\n            top: 100%;\n            left: 0;\n            z-index: 2000;\n            background-color: #4A90E2;\n            border: 1px solid #3680c2;\n            border-radius: 6px;\n            box-shadow: 0 4px 8px rgba(0,0,0,0.3);\n            min-width: 140px;\n            display: none;\n          }\n          /* Видимость dropdown */\n          .template-dropdown.visible {\n            display: block;\n          }\n          /* Элементы dropdown */\n          .template-dropdown-item {\n            padding: 8px 12px;\n            cursor: pointer;\n            transition: background-color 0.2s;\n          }\n          .template-dropdown-item:hover {\n            background-color: #5C5C6E;\n          }\n          /* Общие стили для TinyMCE */\n          .tox-tinymce {\n            border: none !important;\n            border-radius: 4px;\n          }\n          .tox:not(.tox-tinymce-inline) .tox-editor-header {\n            display: none !important;\n          }\n        </style>\n  \n        <div class="editor-container">\n          <button class="insert-button" id="insert-button">Вставить</button>\n          <div class="editor-area">\n            <div id="editor-content"></div>\n          </div>\n        </div>\n        <div class="templates-panel">\n          <div class="templates-header">Шаблоны</div>\n          <div class="template-list" id="template-list"></div>\n          <div class="template-buttons">\n            <div class="template-button remove-template" id="remove-template" title="Удалить шаблон">−</div>\n            <div class="template-button add-template" id="add-template" title="Добавить шаблон">+</div>\n          </div>\n          <div class="edit-template-section">\n            <div class="edit-template-label">Редактировать шаблон</div>\n            <input type="text" class="edit-template-input" id="edit-template-input" placeholder="Введите название шаблона">\n          </div>\n        </div>\n      ',this.templateList=this.querySelector("#template-list"),this.removeTemplateButton=this.querySelector("#remove-template"),this.addTemplateButton=this.querySelector("#add-template"),this.editTemplateInput=this.querySelector("#edit-template-input"),this.insertButton=this.querySelector("#insert-button"),this.renderTemplateList(),this.initEventListeners(),window.addEventListener("load",(()=>{this.initTinyMCE()}))}renderTemplateList(){this.templateList.innerHTML="",this.templates.forEach(((e,t)=>{const n=document.createElement("div");n.className="template-item",t===this.selectedTemplateIndex&&(n.classList.add("selected"),this.editTemplateInput.value=e),n.textContent=e,n.dataset.index=t,this.templateList.appendChild(n)}))}initEventListeners(){this.templateList.addEventListener("click",(e=>{if(e.target.classList.contains("template-item")){const t=parseInt(e.target.dataset.index);this.selectedTemplateIndex=t,this.editTemplateInput.value=this.templates[t],this.renderTemplateList()}})),this.addTemplateButton.addEventListener("click",(()=>{this.templates.push("новый шаблон"),this.selectedTemplateIndex=this.templates.length-1,this.editTemplateInput.value="новый шаблон",this.renderTemplateList(),this.editTemplateInput.focus()})),this.removeTemplateButton.addEventListener("click",(()=>{if(this.templates.length>0&&-1!==this.selectedTemplateIndex){const e=this.templates[this.selectedTemplateIndex];this.templates.splice(this.selectedTemplateIndex,1),0===this.templates.length?(this.selectedTemplateIndex=-1,this.editTemplateInput.value=""):(this.selectedTemplateIndex=Math.min(this.selectedTemplateIndex,this.templates.length-1),this.editTemplateInput.value=this.templates[this.selectedTemplateIndex]),this.renderTemplateList(),this.updateDropdownComponents(e)}})),this.editTemplateInput.addEventListener("blur",(()=>{this.updateSelectedTemplate()})),this.editTemplateInput.addEventListener("keydown",(e=>{"Enter"===e.key&&this.updateSelectedTemplate()})),this.insertButton.addEventListener("click",(()=>{this.insertSpecialComponent()}))}updateSelectedTemplate(){if(-1!==this.selectedTemplateIndex){const e=this.templates[this.selectedTemplateIndex],t=this.editTemplateInput.value.trim();""!==t&&t!==e&&(this.templates[this.selectedTemplateIndex]=t,this.renderTemplateList(),this.updateTemplateReferences(e,t))}}initTinyMCE(){"undefined"!=typeof tinymce?(tinymce.PluginManager.add("templatecomponent",(e=>{e.addCommand("insertTemplateComponent",(()=>{this.insertSpecialComponent()})),e.ui.registry.addAutocompleter("templateList",{ch:"@",minChars:0,columns:1,fetch:e=>new Promise((e=>{e(this.templates.map((e=>({value:e,text:e}))))})),onAction:(t,n,o)=>{e.selection.setRng(n);const i=`<span id="${"template-"+Date.now()}" class="template-component" contenteditable="false" data-template="${o}">${o}</span>&nbsp;`;e.insertContent(i),t.hide()}}),e.on("init",(()=>{e.formatter.register("templatecomponent",{inline:"span",classes:"template-component",attributes:{"data-template":"%value"}})})),e.ui.registry.addContextMenu("templatecontextmenu",{update:e=>e.classList.contains("template-component")?"edittemplate removetemplate":""}),e.ui.registry.addMenuItem("edittemplate",{text:"Редактировать шаблон",icon:"edit-block",onAction:()=>{const t=e.selection.getNode();t&&t.classList.contains("template-component")&&this.showTemplateEditor(t)}}),e.ui.registry.addMenuItem("removetemplate",{text:"Удалить шаблон",icon:"remove",onAction:()=>{const t=e.selection.getNode();t&&t.classList.contains("template-component")&&e.dom.remove(t)}})})),tinymce.init({selector:"#editor-content",height:400,menubar:!1,statusbar:!1,plugins:["templatecomponent"],toolbar:"",contextmenu:"templatecontextmenu link table",content_css:!1,content_style:'\n          body { \n            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; \n            padding: 10px; \n            background-color: #1e1e2f;\n            color: #e0e0e0;\n          }\n          .mce-content-body {\n            background-color: #2c2c3c !important;\n          }\n          .tox-tinymce {\n            border: none !important;\n            border-radius: 4px;\n          }\n          .tox:not(.tox-tinymce-inline) .tox-editor-header {\n            display: none !important;\n          }\n          /* Стиль шаблонных компонентов */\n          .template-component {\n            display: inline-block;\n            border: 1px dashed #FFCC00;\n            border-radius: 4px;\n            background-color: #FFD70066;\n            padding: 3px 8px;\n            margin: 2px;\n            cursor: pointer;\n            min-width: 130px;\n            font-weight: 600;\n            transition: background-color 0.2s, transform 0.2s;\n          }\n          .template-component:hover {\n            background-color: #ffe066;\n            transform: scale(1.02);\n          }\n          /* Ошибки */\n          .template-error {\n            display: inline-block;\n            color: #e53935;\n            font-weight: bold;\n            padding: 3px 6px;\n            margin: 2px;\n            border: 1px solid #e53935;\n            border-radius: 4px;\n            background-color: #ffebee;\n          }\n          /* Dropdown для шаблонов внутри редактора */\n          .template-dropdown {\n            position: absolute;\n            top: 100%;\n            left: 0;\n            z-index: 2000;\n            background-color: #4A90E2;\n            border: 1px solid #3680c2;\n            border-radius: 6px;\n            box-shadow: 0 4px 8px rgba(0,0,0,0.3);\n            min-width: 140px;\n            display: none;\n          }\n          .template-dropdown.visible {\n            display: block;\n          }\n          .template-dropdown-item {\n            padding: 8px 12px;\n            cursor: pointer;\n            transition: background-color 0.2s;\n          }\n          .template-dropdown-item:hover {\n            background-color: #5C5C6E;\n          }\n        ',setup:e=>{this.editor=e,e.on("click",(e=>{const t=e.target;t.classList.contains("template-component")?(this.showTemplateSelector(t),e.stopPropagation()):this.closeAllDropdowns()})),e.on("init",(()=>{e.setContent("<p>Здесь пользователь вводит текст</p>"),e.getWin().addEventListener("click",(e=>{e.target.closest(".template-component")||e.target.closest(".template-dropdown")||this.closeAllDropdowns()}))}))}})):console.error("TinyMCE не загружен")}closeAllDropdowns(){this.editor&&this.editor.dom.select(".template-dropdown.visible").forEach((e=>e.classList.remove("visible")))}showTemplateSelector(e){if(!this.editor)return;this.closeAllDropdowns();let t=e.querySelector(".template-dropdown");t||(t=this.editor.dom.create("div",{class:"template-dropdown"}),this.templates.forEach((n=>{const o=this.editor.dom.create("div",{class:"template-dropdown-item","data-value":n},n);this.editor.dom.bind(o,"click",(o=>{e.setAttribute("data-template",n),e.textContent=n,t.classList.remove("visible"),o.stopPropagation()})),t.appendChild(o)})),e.appendChild(t)),t.classList.add("visible")}showTemplateEditor(e){const t=e.getAttribute("data-template"),n=this.templates.indexOf(t);-1!==n&&(this.selectedTemplateIndex=n,this.editTemplateInput.value=t,this.renderTemplateList(),this.editTemplateInput.scrollIntoView({behavior:"smooth"}),this.editTemplateInput.focus())}insertSpecialComponent(){if(!this.editor||0===this.templates.length)return;const e=this.templates[this.selectedTemplateIndex]||this.templates[0],t=`<span id="${"template-"+Date.now()}" class="template-component" contenteditable="false" data-template="${e}">${e}</span>&nbsp;`;this.editor.insertContent(t)}updateDropdownComponents(e){this.editor&&this.editor.dom.select(`.template-component[data-template="${e}"]`).forEach((e=>{const t=this.editor.dom.create("span",{class:"template-error"},"Ошибка");this.editor.dom.replace(t,e)}))}updateTemplateReferences(e,t){this.editor&&this.editor.dom.select(`.template-component[data-template="${e}"]`).forEach((e=>{e.setAttribute("data-template",t),e.textContent=t}))}}customElements.define("editor-app",e)})();